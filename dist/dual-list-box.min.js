!function(t){function e(e,n){var a=!1;if(e.text.indexOf(":")>-1){var s=e.text.split(":");s.length>1&&(a=!0)}t.getJSON(e.uri,function(o){t.each(o,function(l,o){var i="";a?s.forEach(function(t){i+=o[t]+" "}):i=o[e.text];var c=n.some(function(t){return t[e.value]===o[e.value]||t===o[e.value]})===!0;c?t(e.element).find("option[value="+o[e.value]+"]").attr("selected",!0):t("<option>",{value:o[e.value],text:i,selected:c}).appendTo(e.element)}),l(e)})}function n(e){function n(){l.filterByText(t(e.parentElement+" .filter-unselected"),e.timeout,e.parentElement).scrollTop(0).sortOptions(e),a.filterByText(t(e.parentElement+" .filter-selected"),e.timeout,e.parentElement).scrollTop(0).sortOptions(e),r(e),a.trigger("change")}var l=t(e.parentElement+" .unselected"),a=t(e.parentElement+" .selected");t(e.parentElement).find("button").bind("click",function(){if(!h()){switch(t(this).data("type")){case"str":l.find("option:selected").appendTo(a),t(this).prop("disabled",!0);break;case"atr":(l.find("option").length>=e.maxAllBtn&&confirm(e.warning)||l.find("option").length<e.maxAllBtn)&&l.find("option").each(function(){t(this).isVisible()&&t(this).remove().appendTo(a)});break;case"stl":a.find("option:selected").remove().appendTo(l),t(this).prop("disabled",!0);break;case"atl":(a.find("option").length>=e.maxAllBtn&&confirm(e.warning)||a.find("option").length<e.maxAllBtn)&&a.find("option").each(function(){t(this).isVisible()&&t(this).remove().appendTo(l)})}n()}}),t(e.parentElement).closest("form").submit(function(){a.find("option").prop("selected",!0)}),t(e.parentElement).find('input[type="text"]').keypress(function(t){13===t.which&&event.preventDefault()}),t(e.parentElement).find("select").on("dblclick",function(){var e=t(this),s=e.find("option:selected");h()||(e.hasClass("unselected")?s.appendTo(a).attr("selected",!1):e.hasClass("selected")&&s.appendTo(l).attr("selected",!1),n())}),a.filterByText(t(e.parentElement+" .filter-selected"),e.timeout,e.parentElement).scrollTop(0).sortOptions(e),l.filterByText(t(e.parentElement+" .filter-unselected"),e.timeout,e.parentElement).scrollTop(0).sortOptions(e)}function l(t){o(t),p(t),n(t)}function a(e){function n(){return parseInt(i.attr("data-max-selectable"))}function l(){return void 0!==n()&&n()>0}function a(t){return l()&&t>n()}var s=0,o=0,i=t(e+" .selected-title+small");t(e+" .unselected").find("option").each(function(){t(this).isVisible()&&s++}),t(e+" .selected").find("option").each(function(){t(this).isVisible()&&o++}),t(e+" .unselected-count").text(s),t(e+" .selected-count").text(o),a(o)?(i.css("color","#f00"),i.parents("h4").css("color","#f00")):(i.css("color",""),i.parents("h4").css("color","")),d(e)}function s(t,e,n){function l(){return"selected"===t&&e.maxSelectable&&e.maxSelectable>0}function a(){return l()?'data-max-selectable="'+e.maxSelectable+'"':""}return"<small "+a()+"> "+e.beforeCount+e.showingText+'<span class="'+n+'"></span>'+(l()?' of <span class="max-selectable">'+e.maxSelectable+"</span>":"")+e.afterCount+"</small>"}function o(e){t(e.element).parent().attr("id",e.parent);var n=null!=e.id?" id='"+e.id+"'":"";t(e.parentElement).addClass("row").append((0==e.horizontal?'   <div class="col-md-5">':'   <div class="col-md-6">')+'       <h4><span class="unselected-title"></span> '+s("unselected",e,"unselected-count")+'</h4>       <input class="filter form-control filter-unselected" type="text" placeholder="'+e.filterText+'" style="margin-bottom: 5px;">'+(0==e.horizontal?"":i(1,e.moveAllBtn))+'       <select class="unselected '+e.selectClass+'" style="height: 200px; width: 100%;" multiple></select>   </div>'+(0==e.horizontal?c(e.moveAllBtn):"")+(0==e.horizontal?'   <div class="col-md-5">':'   <div class="col-md-6">')+'       <h4><span class="selected-title"></span> '+s("selected",e,"selected-count")+'</h4>       <input class="filter form-control filter-selected" type="text" placeholder="'+e.filterText+'" style="margin-bottom: 5px;">'+(0==e.horizontal?"":i(2,e.moveAllBtn))+'       <select class="selected '+e.selectClass+'" style="height: 200px; width: 100%;" multiple '+n+"></select>   </div>"),t(e.parentElement+" .selected").prop("name",t(e.element).prop("name")),t(e.parentElement+" .unselected-title").text(e.availableText+" "+e.title),t(e.parentElement+" .selected-title").text(e.selectedText+" "+e.title),t("["+n+"]").change(function(t){h()||e.changeCallback(t)})}function i(t,e){return 1==t?(e?'       <button type="button" class="btn btn-default atr" data-type="atr" style="margin-bottom: 5px;"><span class="glyphicon glyphicon-list"></span> <span class="glyphicon glyphicon-chevron-right"></span></button>':"")+'       <button type="button" class="btn btn-default '+(e?"pull-right col-md-6":"col-md-12")+' str" data-type="str" style="margin-bottom: 5px;" disabled><span class="glyphicon glyphicon-chevron-right"></span></button>':'       <button type="button" class="btn btn-default '+(e?"col-md-6":"col-md-12")+' stl" data-type="stl" style="margin-bottom: 5px;" disabled><span class="glyphicon glyphicon-chevron-left"></span></button>'+(e?'       <button type="button" class="btn btn-default col-md-6 pull-right atl" data-type="atl" style="margin-bottom: 5px;"><span class="glyphicon glyphicon-chevron-left"></span> <span class="glyphicon glyphicon-list"></span></button>':"")}function c(t){return'   <div class="col-md-2 center-block" style="margin-top: '+(t?"80px":"130px")+'">'+(t?'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 atr" data-type="atr" style="margin-bottom: 10px;"><span class="glyphicon glyphicon-list"></span> <span class="glyphicon glyphicon-chevron-right"></span></button>':"")+'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 str" data-type="str" style="margin-bottom: 10px;" disabled><span class="glyphicon glyphicon-chevron-right"></span></button>       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 stl" data-type="stl" style="margin-bottom: 10px;" disabled><span class="glyphicon glyphicon-chevron-left"></span></button>'+(t?'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 atl" data-type="atl" style="margin-bottom: 10px;"><span class="glyphicon glyphicon-chevron-left"></span> <span class="glyphicon glyphicon-list"></span></button>':"")+"   </div>"}function r(e){t(e.parentElement+" .unselected").find("option:selected").prop("selected",!1),t(e.parentElement+" .selected").find("option:selected").prop("selected",!1),t(e.parentElement+" .filter").val(""),t(e.parentElement+" select").find("option").each(function(){t(this).show()}),a(e.parentElement)}function p(e){var n=!1;t(e.element).find("option").text(function(l,a){return t(this).data("title",a),a.length>e.textLength?(n=!0,a.substr(0,e.textLength)+"..."):void 0}).each(function(){n&&t(this).prop("title",t(this).data("title")),t(this).is(":selected")?t(this).appendTo(e.parentElement+" .selected"):t(this).appendTo(e.parentElement+" .unselected")}),t(e.element).remove(),r(e)}function d(e){t(e+" .unselected").change(function(){t(e+" .str").prop("disabled",!1)}),t(e+" .selected").change(function(){t(e+" .stl").prop("disabled",!1)}),0==t(e+" .unselected").has("option").length?(t(e+" .atr").prop("disabled",!0),t(e+" .str").prop("disabled",!0)):t(e+" .atr").prop("disabled",!1),0==t(e+" .selected").has("option").length?(t(e+" .atl").prop("disabled",!0),t(e+" .stl").prop("disabled",!0)):t(e+" .atl").prop("disabled",!1)}function u(){return t(m).find("select, input, button")}function h(){return f===!0}var f=!1,m=void 0;t.fn.DualListBox=function(n,a){return this.each(function(){var s={element:t(this).context,uri:"local.json",value:"id",text:"name",title:"Example",json:!0,timeout:500,horizontal:!1,textLength:45,moveAllBtn:!0,maxAllBtn:500,selectClass:"form-control",warning:"Are you sure you want to move this many items? Doing so can cause your browser to become unresponsive.",availableText:"Available",selectedText:"Selected",beforeCount:"- ",afterCount:"",maxSelectable:void 0,showingText:"showing",filterText:"Filter",sort:"case-insensitive",changeCallback:function(){}},o={element:t(this).context,uri:t(this).data("source"),value:t(this).data("value"),text:t(this).data("text"),title:t(this).data("title"),json:t(this).data("json"),timeout:t(this).data("timeout"),horizontal:t(this).data("horizontal"),textLength:t(this).data("textLength"),moveAllBtn:t(this).data("moveAllBtn"),maxAllBtn:t(this).data("maxAllBtn"),selectClass:t(this).data("selectClass"),availableText:t(this).data("availableText"),selectedText:t(this).data("selectedText"),beforeCount:t(this).data("beforeCount"),afterCount:t(this).data("afterCount"),maxSelectable:t(this).data("maxSelectable"),showingText:t(this).data("showingText"),filterText:t(this).data("filterText"),sort:t(this).data("sort"),id:t(this).attr("id")},i=t.extend({},s,o,n);t.each(i,function(t,e){if(void 0===e||null===e)throw"DualListBox: "+t+" is undefined."}),i.parent="dual-list-box-"+i.title.replace(/ /g,"_"),i.parentElement="#"+i.parent,m=i.parentElement,a=t.extend([{}],a),t.each(i.element.options,function(t,e){a.push(e.value)}),i.json?e(i,a):l(i)})},t.fn.filterByText=function(e,n,l){return this.each(function(){var s=this,o=[];t(s).find("option").each(function(){o.push({value:t(this).val(),text:t(this).text()})}),t(s).data("options",o),t(e).bind("change keyup",function(){RegExp.escape=function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},b(function(){var n=t(s).data("options"),o=t.trim(t(e).val()),i=new RegExp(RegExp.escape(o),"gi");t.each(n,function(e){null===n[e].text.match(i)?t(s).find(t('option[value="'+n[e].value+'"]')).hide():t(s).find(t('option[value="'+n[e].value+'"]')).show()}),a(l)},n)})})},t.fn.isVisible=function(){return!("hidden"==t(this).css("visibility")||"none"==t(this).css("display"))},t.fn.sortOptions=function(e){return this.each(function(){var n=t(this).find("option").remove();e.sort!==!1&&n.sort(function(n,l){var a=t(n).text(),s=t(l).text();return"case-insensitive"===e.sort&&(a=a.toLowerCase(),s=s.toLowerCase()),a>s?1:s>a?-1:0}),t(this).append(n)})},t.fn.lock=function(){return f=!0,u().attr("disabled",f),f},t.fn.unlock=function(){return f=!1,u().attr("disabled",f),f},t.fn.isLocked=h;var b=function(){var t=0;return function(e,n){clearTimeout(t),t=setTimeout(e,n)}}()}(jQuery);